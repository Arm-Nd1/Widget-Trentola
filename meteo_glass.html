<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Meteo ‚Äî stile vetro compat iCUE</title>
<style>
  :root{
    --text:#e6edf3; --muted:#9aa7b3; --good:#a7f3d0;
    --accent1:#6f3cff; --accent2:#2dd4bf;
    --cardBg: rgba(10,12,16,0.30);
    --borderAlpha: .18;
  }
  html,body{height:100%;margin:0;color:var(--text);font:16px system-ui}
  body{background:#0a0c10}
  .wrap{height:100%;padding:14px;box-sizing:border-box}
  .card{height:100%;border-radius:18px;display:grid;grid-template-columns: 0.58fr 0.42fr;gap:18px;overflow:hidden}
  .left{padding:18px;display:grid;grid-template-rows:auto 1fr auto;align-items:center}
  .tempRow{display:flex;align-items:center;gap:18px}
  .temp{font-size:110px;font-weight:900;line-height:.9;text-shadow:0 2px 6px rgba(0,0,0,.5)}
  .icon{font-size:56px;filter:drop-shadow(0 2px 4px rgba(0,0,0,.4))}
  .place{margin-top:6px;font-weight:700;letter-spacing:.3px}
  .chips{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
  .chip{font-size:13px;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08)}
  .right{padding:18px;display:flex;flex-direction:column;gap:12px}
  .row{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-radius:14px;backdrop-filter: blur(10px);}
  .row[data-neon="1"]{ border:1px solid rgba(255,255,255,var(--borderAlpha));
    box-shadow: 0 0 0 1px rgba(255,255,255,.05) inset, 0 0 22px rgba(111,60,255,.22), 0 0 22px rgba(45,212,191,.18);}
  .rowTitle{display:flex;align-items:center;gap:10px;font-weight:800}
  .rowIcon{font-size:22px}
  .rowTemp{font-weight:900}
  .muted{color:var(--muted)}
  .glass{background:var(--cardBg)}
  .clear{background:transparent}
  .black{background:#0a0c10}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="left">
      <div class="tempRow">
        <div class="temp" id="temp">--¬∞</div>
        <div class="icon" id="icon">‚òÄÔ∏è</div>
      </div>
      <div class="place" id="place">‚Äî</div>
      <div class="chips">
        <div class="chip" id="wind">Vento ‚Äî</div>
        <div class="chip" id="sun">Alba ‚Äî ‚Ä¢ Tramonto ‚Äî</div>
      </div>
    </div>
    <div class="right" id="right">
      <!-- forecast rows injected here -->
    </div>
  </div>
</div>
<script>
const qs = new URLSearchParams(location.search);
const scale = Math.max(0.9, Math.min(1.6, parseFloat(qs.get('scale')) || 1.1));
document.documentElement.style.fontSize = (16*scale)+'px';
const bg = (qs.get('bg')||'black').toLowerCase();
const alpha = Math.max(0, Math.min(0.35, parseFloat(qs.get('alpha')) || 0.22));
const neon = (qs.get('neon')||'1') === '1';
if(bg==='glass'){ document.body.style.background='transparent'; document.documentElement.style.setProperty('--cardBg','rgba(10,12,16,'+alpha+')'); }
else if(bg==='clear'){ document.body.style.background='transparent'; document.documentElement.style.setProperty('--cardBg','rgba(10,12,16,0.0)'); }
// Default coords: Trentola-Ducenta
const lat = parseFloat(qs.get('lat')||'40.97');
const lon = parseFloat(qs.get('lon')||'14.18');
const iconFor = code => {
  if([0].includes(code)) return '‚òÄÔ∏è';
  if([1,2,3].includes(code)) return 'üå§Ô∏è';
  if([45,48].includes(code)) return 'üå´Ô∏è';
  if([51,53,55,56,57].includes(code)) return 'üå¶Ô∏è';
  if([61,63,65,80,81,82].includes(code)) return 'üåßÔ∏è';
  if([71,73,75,77,85,86].includes(code)) return 'üå®Ô∏è';
  if([95,96,99].includes(code)) return '‚õàÔ∏è';
  return '‚õÖ';
};
const fmtDay = iso => {
  const d = new Date(iso+'T12:00:00');
  return d.toLocaleDateString('it-IT',{weekday:'long'});
};
async function fetchWeather(){
  try{
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,wind_speed_10m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min,sunrise,sunset&timezone=auto`;
    const res = await fetch(url);
    const data = await res.json();
    let place = qs.get('place');
    if(!place){
      try{
        const g = await fetch(`https://geocoding-api.open-meteo.com/v1/reverse?latitude=${lat}&longitude=${lon}&language=it`);
        const gj = await g.json();
        place = (gj && gj.results && gj.results[0]) ? (gj.results[0].name + (gj.results[0].admin1? ', '+gj.results[0].admin1:'')) : 'Localit√†';
      }catch(e){ place = 'Localit√†'; }
    }
    const t = Math.round(data.current.temperature_2m);
    document.getElementById('temp').textContent = t + '¬∞';
    document.getElementById('icon').textContent = iconFor(data.current.weather_code);
    document.getElementById('place').textContent = place;
    document.getElementById('wind').textContent = `Vento: ${Math.round(data.current.wind_speed_10m)} m/s`;
    const sr = new Date(data.daily.sunrise[0]).toLocaleTimeString('it-IT',{hour:'2-digit',minute:'2-digit'});
    const ss = new Date(data.daily.sunset[0]).toLocaleTimeString('it-IT',{hour:'2-digit',minute:'2-digit'});
    document.getElementById('sun').textContent = `Alba ${sr} ‚Ä¢ Tramonto ${ss}`;
    const right = document.getElementById('right');
    right.innerHTML='';
    for(let i=1;i<=3;i++){
      const dayName = fmtDay(data.daily.time[i]);
      const code = data.daily.weather_code[i];
      const tmax = Math.round(data.daily.temperature_2m_max[i]);
      const tmin = Math.round(data.daily.temperature_2m_min[i]);
      const row = document.createElement('div');
      row.className = 'row glass';
      row.dataset.neon = neon ? '1' : '0';
      row.innerHTML = `
        <div class="rowTitle"><span class="rowIcon">${iconFor(code)}</span><span>${dayName}</span></div>
        <div class="rowTemp">${tmax}¬∞ / ${tmin}¬∞</div>
      `;
      right.appendChild(row);
    }
  }catch(e){
    document.getElementById('place').textContent = 'Errore caricamento meteo';
    console.error(e);
  }
}
fetchWeather();
setInterval(fetchWeather, 30*60*1000);
</script>
</body>
</html>
